<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>차트 테스트</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h1>차트 렌더링 테스트</h1>
        <button id="loadChart" class="btn btn-primary">차트 로드</button>
        <div id="chartContainer" class="mt-4">
            <!-- 차트가 여기에 표시됩니다 -->
        </div>
    </div>

    <script>
        document.getElementById('loadChart').addEventListener('click', function() {
            console.log('🔍 차트 로딩 시작...');
            
            fetch('/financial-api?corp_code=00126380&corp_name=삼성전자&view_mode=single&year=2022&report_code=11011')
                .then(response => response.json())
                .then(data => {
                    console.log('📊 응답 받음:', data.success);
                    
                    if (data.success && data.charts) {
                        const container = document.getElementById('chartContainer');
                        let html = '';
                        
                        for (const [chartName, chartHtml] of Object.entries(data.charts)) {
                            console.log(`📈 차트 추가: ${chartName}`);
                            html += `
                                <div class="mb-4">
                                    <h3>${chartName}</h3>
                                    ${chartHtml}
                                </div>
                            `;
                        }
                        
                        container.innerHTML = html;
                        console.log('✅ 차트 HTML 삽입 완료');
                        
                        // 스크립트 실행
                        const scripts = container.querySelectorAll('script');
                        console.log(`📜 스크립트 개수: ${scripts.length}`);
                        
                        scripts.forEach((script, index) => {
                            try {
                                eval(script.textContent);
                                console.log(`✅ 스크립트 ${index + 1} 실행 완료`);
                            } catch (error) {
                                console.error(`❌ 스크립트 ${index + 1} 오류:`, error);
                            }
                        });
                    } else {
                        console.error('❌ 차트 데이터 없음');
                    }
                })
                .catch(error => {
                    console.error('❌ 오류:', error);
                });
        });
    </script>
</body>
</html>